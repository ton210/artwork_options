<div class="bg-white rounded-lg shadow-lg p-6 border-2 border-green-200">
  <h3 class="text-2xl font-bold text-gray-900 mb-2">
    <% if (typeof formTitle !== 'undefined') { %>
      <%= formTitle %>
    <% } else { %>
      Get Wholesale Quote
    <% } %>
  </h3>

  <p class="text-gray-600 mb-6">
    <% if (typeof formDescription !== 'undefined') { %>
      <%= formDescription %>
    <% } else { %>
      Fill out the form below and we'll get back to you within 24 hours.
    <% } %>
  </p>

  <form id="leadForm" class="space-y-4">
    <% if (typeof dispensaryId !== 'undefined') { %>
      <input type="hidden" name="dispensaryId" value="<%= dispensaryId %>">
    <% } %>

    <% if (typeof dispensaryName !== 'undefined') { %>
      <input type="hidden" name="dispensaryName" value="<%= dispensaryName %>">
    <% } %>

    <input type="hidden" name="source" value="<%= source || 'sidebar' %>">

    <div>
      <label class="block text-gray-700 font-medium mb-2">Your Name *</label>
      <input type="text" name="contactName" required
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-2">Email *</label>
      <input type="email" name="email" required
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-2">Phone</label>
      <input type="tel" name="phone"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
    </div>

    <% if (typeof showDispensaryField !== 'undefined' && showDispensaryField) { %>
      <div>
        <label class="block text-gray-700 font-medium mb-2">Dispensary Name</label>
        <input type="text" name="dispensaryName"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
      </div>
    <% } %>

    <div>
      <label class="block text-gray-700 font-medium mb-2">Message</label>
      <textarea name="message" rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
    </div>

    <button type="submit"
            class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition">
      Send Message
    </button>
  </form>

  <div id="leadFormSuccess" class="hidden bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
    <div class="flex items-start gap-2">
      <div class="text-2xl">✅</div>
      <div>
        <div class="font-semibold text-green-900">Success!</div>
        <div class="text-green-800 text-sm">
          Thank you! We'll contact you soon.
        </div>
      </div>
    </div>
  </div>

  <div id="leadFormError" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mt-4">
    <div class="flex items-start gap-2">
      <div class="text-2xl">❌</div>
      <div>
        <div class="font-semibold text-red-900">Error</div>
        <div class="text-red-800 text-sm" id="leadFormErrorMessage">
          Something went wrong. Please try again.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('leadForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  try {
    const response = await fetch('/leads/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (result.success) {
      document.getElementById('leadFormSuccess').classList.remove('hidden');
      document.getElementById('leadFormError').classList.add('hidden');
      e.target.reset();

      // Hide success message after 5 seconds
      setTimeout(() => {
        document.getElementById('leadFormSuccess').classList.add('hidden');
      }, 5000);
    } else {
      document.getElementById('leadFormError').classList.remove('hidden');
      document.getElementById('leadFormSuccess').classList.add('hidden');
      document.getElementById('leadFormErrorMessage').textContent = result.message || 'Error submitting form';
    }
  } catch (error) {
    document.getElementById('leadFormError').classList.remove('hidden');
    document.getElementById('leadFormSuccess').classList.add('hidden');
    document.getElementById('leadFormErrorMessage').textContent = 'Network error. Please try again.';
  }
});
</script>
